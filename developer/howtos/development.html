<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Development Guidelines - Epinio - the application development engine for Kubernetes</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documentation for users and developers of Epinio">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../favicon.png">
        
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        
        <link rel="stylesheet" href="../../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../user/tutorials/quickstart.html"><strong aria-hidden="true">2.</strong> Quick Start</a></li><li class="chapter-item expanded "><a href="../../user/index.html"><strong aria-hidden="true">3.</strong> User documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../user/installation/installation.html"><strong aria-hidden="true">3.1.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../user/installation/install_epinio_cli.html"><strong aria-hidden="true">3.1.1.</strong> Install Epinio cli</a></li><li class="chapter-item expanded "><a href="../../user/installation/install_epinio_customDNS.html"><strong aria-hidden="true">3.1.2.</strong> Install Epinio with custom DNS</a></li><li class="chapter-item expanded "><a href="../../user/installation/install_epinio_magicDNS.html"><strong aria-hidden="true">3.1.3.</strong> Install Epinio with &quot;magic&quot; DNS</a></li><li class="chapter-item expanded "><a href="../../user/installation/install_epinio_on_aks.html"><strong aria-hidden="true">3.1.4.</strong> Install Epinio on AKS (Azure)</a></li><li class="chapter-item expanded "><a href="../../user/installation/install_epinio_on_eks.html"><strong aria-hidden="true">3.1.5.</strong> Install Epinio on EKS (Amazon)</a></li><li class="chapter-item expanded "><a href="../../user/installation/install_epinio_on_gke.html"><strong aria-hidden="true">3.1.6.</strong> Install Epinio on GKE (Google)</a></li><li class="chapter-item expanded "><a href="../../user/installation/install_epinio_on_k3d.html"><strong aria-hidden="true">3.1.7.</strong> Install Epinio on k3d (local)</a></li><li class="chapter-item expanded "><a href="../../user/installation/install_wordpress_application.html"><strong aria-hidden="true">3.1.8.</strong> Install Wordpress on Epinio</a></li></ol></li><li class="chapter-item expanded "><a href="../../user/installation/uninstall_epinio.html"><strong aria-hidden="true">3.2.</strong> Uninstall Epinio</a></li><li class="chapter-item expanded "><a href="../../user/explanations/explanations.html"><strong aria-hidden="true">3.3.</strong> Explanations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../user/explanations/advanced.html"><strong aria-hidden="true">3.3.1.</strong> Advanced topics</a></li><li class="chapter-item expanded "><a href="../../user/explanations/configuration.html"><strong aria-hidden="true">3.3.2.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../../user/explanations/detailed-push-process.html"><strong aria-hidden="true">3.3.3.</strong> Detailed Push Process</a></li><li class="chapter-item expanded "><a href="../../user/explanations/principles.html"><strong aria-hidden="true">3.3.4.</strong> Principles</a></li><li class="chapter-item expanded "><a href="../../user/explanations/security.html"><strong aria-hidden="true">3.3.5.</strong> Security</a></li><li class="chapter-item expanded "><a href="../../user/explanations/windows.html"><strong aria-hidden="true">3.3.6.</strong> Windows</a></li></ol></li><li class="chapter-item expanded "><a href="../../user/howtos/howtos.html"><strong aria-hidden="true">3.4.</strong> HowTos</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../user/howtos/certificate_issuers.html"><strong aria-hidden="true">3.4.1.</strong> Certificate Issuers</a></li><li class="chapter-item expanded "><a href="../../user/howtos/provision_external_ip_for_local_kubernetes.html"><strong aria-hidden="true">3.4.2.</strong> Provision external IP address for local Kubernetes</a></li><li class="chapter-item expanded "><a href="../../user/howtos/gitjob_push.html"><strong aria-hidden="true">3.4.3.</strong> Push with gitjob</a></li><li class="chapter-item expanded "><a href="../../user/howtos/setup-external-s3.html"><strong aria-hidden="true">3.4.4.</strong> Setup external S3 storage</a></li></ol></li><li class="chapter-item expanded "><a href="../../user/references/references.html"><strong aria-hidden="true">3.5.</strong> Reference documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../user/references/index.html"><strong aria-hidden="true">3.5.1.</strong> Command requirements</a></li><li class="chapter-item expanded "><a href="../../user/references/commands.html"><strong aria-hidden="true">3.5.2.</strong> Command reference</a></li><li class="chapter-item expanded "><a href="../../user/references/supported-apps.html"><strong aria-hidden="true">3.5.3.</strong> Supported Applications</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../developer/index.html"><strong aria-hidden="true">4.</strong> Developer documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../developer/explanations/explanations.html"><strong aria-hidden="true">4.1.</strong> Explanations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../developer/explanations/futureplans.html"><strong aria-hidden="true">4.1.1.</strong> Future plans</a></li></ol></li><li class="chapter-item expanded "><a href="../../developer/howtos/howtos.html"><strong aria-hidden="true">4.2.</strong> HowTos</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../developer/howtos/development.html" class="active"><strong aria-hidden="true">4.2.1.</strong> Development Guidelines</a></li><li class="chapter-item expanded "><a href="../../developer/howtos/new-api-user.html"><strong aria-hidden="true">4.2.2.</strong> Add a new API User</a></li><li class="chapter-item expanded "><a href="../../developer/howtos/acceptance_tests.html"><strong aria-hidden="true">4.2.3.</strong> Run acceptance test suites</a></li><li class="chapter-item expanded "><a href="../../developer/howtos/custom-python-builder.html"><strong aria-hidden="true">4.2.4.</strong> Create and use a custom builder for Python</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Epinio - the application development engine for Kubernetes</h1>

                    <div class="right-buttons">
                        
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/epinio/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        
                        <a href="https://github.com/epinio/docs/edit/main/src/developer/howtos/development.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="development-guidelines"><a class="header" href="#development-guidelines">Development Guidelines</a></h1>
<h2 id="local-development-environment"><a class="header" href="#local-development-environment">Local development environment</a></h2>
<h3 id="get-a-cluster"><a class="header" href="#get-a-cluster">Get a cluster</a></h3>
<p>There are many options on how to get a local cluster for development. Here are a few:</p>
<ul>
<li><a href="https://k3d.io/">k3d</a></li>
<li><a href="https://github.com/k3s-io/k3s">k3s</a></li>
<li><a href="https://github.com/kubernetes-sigs/kind">kind</a></li>
<li><a href="https://minikube.sigs.k8s.io/docs/start/">minikube</a></li>
</ul>
<p>Assuming you have <code>k3d</code> installed, you can create a cluster with this command:</p>
<pre><code>k3d cluster create epinio
</code></pre>
<p>This command should automatically update your default kubeconfig to point to
the new cluster but if you need to save your kubeconfig manually you can do it with:</p>
<pre><code>k3d kubeconfig get epinio &gt; epinio_kubeconfig
</code></pre>
<h3 id="build-epinio"><a class="header" href="#build-epinio">Build Epinio</a></h3>
<p>You can build Epinio with the following make target:</p>
<pre><code>make build
</code></pre>
<p>This is building Epinio for linux on amd64 architecture. If you are on a
different OS or architecture you can use one of other the available <code>build-*</code> targets.
Look at the Makefile at the root of the project to see what is available.</p>
<h3 id="installing-epinio"><a class="header" href="#installing-epinio">Installing Epinio</a></h3>
<p>You can have a look at <a href="/docs/user/howtos/install.html">the dedicated document</a> for cluster
specific instructions, but generally this should be sufficient to get you running:</p>
<pre><code>make install
./dist/epinio-linux-amd64 namespace create workspace
./dist/epinio-linux-amd64 target workspace
</code></pre>
<p>In case you're curious why <code>make install</code> is used here instead of
<code>epinio install</code>, we have a section to look
<a href="#curtain">Behind the curtains</a> at the end of the document, which
explains the details of running an Epinio dev environment.</p>
<p>After making changes to the binary simply invoking <code>make patch-epinio-deployment</code> again will upload the changes into the
running cluster.</p>
<p>Another thing <code>epinio install</code> does after deploying all components is
the creation and targeting of a standard namespace, <code>workspace</code>.</p>
<p>With the failing server component these actions will fail, making the
installation fail. Using the option <code>--skip-default-namespace</code> instructs the
command to forego these actions. Which in turn makes it necessary to
run them manually to reach the standard state of a cluster. These are
the last two commands in the above script.</p>
<p>The one post-deployment action performed by <code>install</code> not affected by
all of the above is the automatic <code>config update-credentials</code> saving
API credentials and certs into the client configuration file. As that
command talks directly to the cluster and not the epinio API the
failing server component does not matter.</p>
<p>If the cluster is not running on linux-amd64 it will be necessary to set
<code>EPINIO_BINARY_PATH</code> to the correct binary to place into the epinio server
(<a href="https://github.com/epinio/epinio/blob/a4b679af88d58177cecf4a5717c8c96f382058ed/scripts/patch-epinio-deployment.sh#L19">See here</a>).</p>
<p>If the client operation is performed outside of a git checkout it will be
necessary to set <code>EPINIO_BINARY_TAG</code> to the correct tag
(<a href="https://github.com/epinio/epinio/blob/a4b679af88d58177cecf4a5717c8c96f382058ed/scripts/patch-epinio-deployment.sh#L20">See here</a>).</p>
<p>The make target <code>tag</code> can be used in the checkout the binary came from to
determine this value.</p>
<p>Also, the default <code>make build</code> target builds a dynamically linked
binary. This can cause issues if for example the glibc library in the
base image doesn't match the one on the build system. To get past that
issue it is necessary to build a statically linked binary with a
command like:</p>
<pre><code>GOARCH=&quot;amd64&quot; GOOS=&quot;linux&quot; CGO_ENABLED=0 go build -o dist/epinio-linux-amd64
</code></pre>
<h4 id="mixed-windowslinux-scenario"><a class="header" href="#mixed-windowslinux-scenario">Mixed Windows/Linux Scenario</a></h4>
<p>A concrete example of the above would be the installation of Epinio from a
Windows host without a checkout, to a Linux-based cluster.</p>
<p>In that scenario the Windows host has to have both windows-amd64 and linux-amd64
binaries. The first to perform the installation, the second for
<code>EPINIO_BINARY_PATH</code> to be put into the server.</p>
<p>Furthermore, as the Windows host is without a checkout, the tag has to be
determined in the actual checkout and set into <code>EPINIO_BINARY_PATH</code>.</p>
<p>Lastly, do not forget to set up a proper domain so that the client can talk to
the server after installation is done. While during installation only a suitable
<code>KUBECONFIG</code> is required after the client will go and use the information from
the ingress, and that then has to properly resolve in the DNS.</p>
<a id='curtain'>
<h4 id="behind-the-curtains"><a class="header" href="#behind-the-curtains">Behind the curtains</a></h4>
<p><code>make install</code> does quite a bit more than the plain</p>
<pre><code>epinio install
</code></pre>
<p>found in the quick install intructions.</p>
<p>Let's look at what <code>make install</code> actually does:</p>
<p>When building Epinio, the generated binary assumes that there is a
container image for the Epinio server components, with a tag that
matches the commit you built from.  For example, when calling <code>make build</code> on commit <code>7bfb700</code>, the version reported by Epinio is
something like <code>v0.0.5-75-g7bfb700</code> and an image <code>epinio/server:v0.0.5-75-g7bfb700</code>
is expected to be found.</p>
<p>This works fine for released versions, because the release pipeline ensures
that such an image is built and published.</p>
<p>However when building locally building and publishing an image for
every little change is ... inconvenient.</p>
<p><code>make install</code> is setting</p>
<pre><code>export EPINIO_DONT_WAIT_FOR_DEPLOYMENT=1
</code></pre>
<p>before calling the <code>epinio</code> binary that was created during <code>make build</code>.</p>
<p>This tells the <code>epinio install</code> command to not wait for the Epinio server
deployment. Since that will be failing without the image. Inspecting
the cluster with</p>
<pre><code>kubectl get pod -n epinio --selector=app.kubernetes.io/name=epinio-server
</code></pre>
<p>will confirm this.</p>
<p>Then <code>make install</code> runs <code>scripts/patch-epinio-deployment.sh</code> which compensates for this
issue. This make target patches the failing Epinio server deployment
to use an existing image from some release and then copies the locally
built <code>dist/epinio-linux-amd64</code> binary into it, ensuring that it runs
the same binary as the client.</p>
<p><strong>Note</strong> When building for another OS or architecture the
<code>dist/epinio-linux-amd64</code> binary will not exist, and the script has to
be adjusted accordingly.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../developer/howtos/howtos.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../developer/howtos/new-api-user.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../developer/howtos/howtos.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../developer/howtos/new-api-user.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
